name: Test Edge Removal

on:
  workflow_dispatch:

jobs:
  test-edge-removal:
    runs-on: windows-2019
    steps:
      - uses: actions/checkout@v4
      - name: Test Edge Removal
        shell: pwsh
        run: |
          Write-Host "Starting Edge removal test..."
          
          # Stop Edge processes
          $stop = "MicrosoftEdgeUpdate", "msedge", "msedgewebview2"
          $stop | ForEach-Object { Stop-Process -Name $_ -Force -ErrorAction SilentlyContinue }
          
          # Remove Legacy Edge AppX package
          Write-Host "Removing Edge packages..."
          Get-AppxPackage -AllUsers *Microsoft.MicrosoftEdge* | Remove-AppxPackage -AllUsers
          Get-AppxPackage -AllUsers *Microsoft.MicrosoftEdgeDevToolsClient* | Remove-AppxPackage -AllUsers
          
          # Verify removal
          Write-Host "`nVerifying Edge removal..."
          $edgeExists = Test-Path "C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe"
          Write-Host "Edge executable exists: $edgeExists"
          
          $edgePackages = Get-AppxPackage -AllUsers *Microsoft.MicrosoftEdge* | Select-Object -ExpandProperty Name
          if ($edgePackages) {
              Write-Error "Edge packages still exist: $edgePackages"
              exit 1
          } else {
              Write-Host "Edge removal successful!"
          }
